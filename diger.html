<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber-Digger - Multi Level</title>
    <style>
        :root {
            --cell-size: 40px;
            --bg-dirt: #3d2b1f;
            --bg-empty: #1a120b;
        }

        body {
            margin: 0;
            background-color: #050505;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            touch-action: none;
        }

        #game-container {
            position: relative;
            border: 4px solid #5d4037;
            background-color: var(--bg-empty);
            display: grid;
            grid-template-columns: repeat(9, var(--cell-size));
            grid-template-rows: repeat(13, var(--cell-size));
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }

        .dirt { background-color: var(--bg-dirt); border: 0.5px solid #2d1f16; }
        .empty { background-color: var(--bg-empty); }
        .crystal::after { content: 'üíé'; filter: drop-shadow(0 0 5px #00f2fe); animation: pulse 1s infinite alternate; }
        .rock::after { content: 'üåë'; filter: drop-shadow(2px 2px 2px #000); }

        #player {
            position: absolute;
            width: var(--cell-size);
            height: var(--cell-size);
            background: #ffeb3b;
            border-radius: 4px;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.1s ease;
            box-shadow: 0 0 10px #ffeb3b;
        }
        #player::after { content: 'ü§ñ'; font-size: 24px; }

        #ui {
            position: absolute;
            top: -45px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            color: #0f0;
            font-size: 18px;
        }

        /* Mesaj de succes la nivel complet */
        #victory-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 255, 0, 0.2);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 150;
            backdrop-filter: blur(2px);
        }
        #victory-overlay h1 {
            background: #000;
            color: #0f0;
            padding: 20px;
            border: 3px solid #0f0;
            text-shadow: 0 0 10px #0f0;
        }

        @keyframes pulse { from { transform: scale(0.8); } to { transform: scale(1.1); } }

        #game-over {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        button { padding: 10px 20px; background: #4caf50; color: white; border: none; cursor: pointer; margin-top: 15px; font-weight: bold;}
    </style>
</head>
<body>

<div style="position: relative;">
    <div id="ui">
        <span>üíé: <span id="score">0</span></span>
        <span>‚ù§Ô∏è: <span id="lives">3</span></span>
    </div>
    
    <div id="game-container">
        <div id="player"></div>
    </div>

    <div id="victory-overlay">
        <h1>BRAVO! NIVEL COMPLET!</h1>
    </div>

    <div id="game-over">
        <h2>SISTEM CRITIC!</h2>
        <p>Scor final: <span id="final-score">0</span></p>
        <button onclick="location.reload()">REPORNIRE</button>
    </div>
</div>

<script>
    const container = document.getElementById('game-container');
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const victoryOverlay = document.getElementById('victory-overlay');
    const gameOverScreen = document.getElementById('game-over');

    const ROWS = 13;
    const COLS = 9;
    let score = 0;
    let lives = 3;
    let grid = [];
    let playerPos = { x: 4, y: 0 };
    let crystalsLeft = 0;
    let gameActive = true;

    function initGame() {
        container.innerHTML = '<div id="player"></div>';
        grid = [];
        crystalsLeft = 0;
        playerPos = { x: 4, y: 0 };
        victoryOverlay.style.display = 'none';
        
        for (let y = 0; y < ROWS; y++) {
            grid[y] = [];
            for (let x = 0; x < COLS; x++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                
                let type = 'dirt';
                if (y === 0 && x === 4) type = 'empty';
                else if (Math.random() < 0.15 && y > 1) type = 'rock';
                else if (Math.random() < 0.10 && y > 1) { 
                    type = 'crystal';
                    crystalsLeft++;
                }
                
                cell.classList.add(type);
                container.appendChild(cell);
                grid[y][x] = { el: cell, type: type };
            }
        }
        // DacƒÉ printr-o minune nu s-au generat cristale, for»õƒÉm unul
        if (crystalsLeft === 0) {
            grid[5][5].type = 'crystal';
            grid[5][5].el.className = 'cell crystal';
            crystalsLeft = 1;
        }
        updatePlayerDisplay();
    }

    function updatePlayerDisplay() {
        const p = document.getElementById('player');
        p.style.left = (playerPos.x * 40) + 'px';
        p.style.top = (playerPos.y * 40) + 'px';
    }

    window.addEventListener('keydown', (e) => {
        if (!gameActive) return;
        let nx = playerPos.x;
        let ny = playerPos.y;

        if (e.key === 'ArrowUp') ny--;
        if (e.key === 'ArrowDown') ny++;
        if (e.key === 'ArrowLeft') nx--;
        if (e.key === 'ArrowRight') nx++;

        if (nx >= 0 && nx < COLS && ny >= 0 && ny < ROWS) {
            if (grid[ny][nx].type !== 'rock') {
                playerPos.x = nx;
                playerPos.y = ny;
                
                const current = grid[ny][nx];
                if (current.type === 'dirt') {
                    current.type = 'empty';
                    current.el.className = 'cell empty';
                } else if (current.type === 'crystal') {
                    current.type = 'empty';
                    current.el.className = 'cell empty';
                    score += 50;
                    scoreEl.innerText = score;
                    crystalsLeft--;
                    checkVictory();
                }
                updatePlayerDisplay();
            }
        }
    });

    function checkVictory() {
        if (crystalsLeft === 0) {
            gameActive = false;
            score += 200; // Bonus nivel
            scoreEl.innerText = score;
            victoryOverlay.style.display = 'flex';
            
            setTimeout(() => {
                gameActive = true;
                initGame();
            }, 2000);
        }
    }

    // Fizica Bolovanilor
    setInterval(() => {
        if (!gameActive) return;
        for (let y = ROWS - 1; y >= 0; y--) {
            for (let x = 0; x < COLS; x++) {
                if (grid[y][x].type === 'rock') {
                    let belowY = y + 1;
                    if (belowY < ROWS) {
                        if (grid[belowY][x].type === 'empty') {
                            // VerificƒÉm dacƒÉ player-ul este sub bolovan
                            if (playerPos.x === x && playerPos.y === belowY) {
                                hitPlayer();
                            }
                            grid[y][x].type = 'empty';
                            grid[y][x].el.className = 'cell empty';
                            grid[belowY][x].type = 'rock';
                            grid[belowY][x].el.className = 'cell rock';
                        }
                    }
                }
            }
        }
    }, 400);

    function hitPlayer() {
        lives--;
        livesEl.innerText = lives;
        container.style.boxShadow = "inset 0 0 50px red";
        setTimeout(() => container.style.boxShadow = "none", 300);

        if (lives <= 0) {
            gameActive = false;
            gameOverScreen.style.display = 'flex';
            document.getElementById('final-score').innerText = score;
        }
    }

    initGame();
</script>
</body>
</html>