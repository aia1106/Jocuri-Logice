<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber-Digger - Mobile Ready</title>
    <style>
        :root {
            --cell-size: 35px; /* Mic»ôorat pu»õin pentru a √ÆncƒÉpea pe ecrane de telefon */
            --bg-dirt: #3d2b1f;
            --bg-empty: #1a120b;
        }

        body {
            margin: 0;
            background-color: #050505;
            display: flex;
            flex-direction: column; /* ColoanƒÉ pentru a face loc butoanelor sub joc */
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            touch-action: none;
        }

        #game-container {
            position: relative;
            border: 4px solid #5d4037;
            background-color: var(--bg-empty);
            display: grid;
            grid-template-columns: repeat(9, var(--cell-size));
            grid-template-rows: repeat(13, var(--cell-size));
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
        }

        .dirt { background-color: var(--bg-dirt); border: 0.5px solid #2d1f16; }
        .empty { background-color: var(--bg-empty); }
        .crystal::after { content: 'üíé'; filter: drop-shadow(0 0 5px #00f2fe); animation: pulse 1s infinite alternate; }
        .rock::after { content: 'üåë'; filter: drop-shadow(2px 2px 2px #000); }

        #player {
            position: absolute;
            width: var(--cell-size);
            height: var(--cell-size);
            background: #ffeb3b;
            border-radius: 4px;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.1s ease;
            box-shadow: 0 0 10px #ffeb3b;
        }
        #player::after { content: 'ü§ñ'; font-size: 20px; }

        #ui {
            width: 100%;
            max-width: calc(9 * var(--cell-size));
            display: flex;
            justify-content: space-between;
            color: #0f0;
            font-size: 18px;
            margin-bottom: 5px;
        }

        /* CONTROALE MOBIL - DPAD */
        #controls {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            grid-template-rows: repeat(2, 60px);
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #5d4037;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: white;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active { background: rgba(255, 235, 59, 0.4); }
        #btn-up { grid-column: 2; }
        #btn-left { grid-column: 1; grid-row: 2; }
        #btn-down { grid-column: 2; grid-row: 2; }
        #btn-right { grid-column: 3; grid-row: 2; }

        #victory-overlay, #game-over {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: none; justify-content: center; align-items: center; z-index: 150;
        }

        #victory-overlay h1 { background: #000; color: #0f0; padding: 20px; border: 3px solid #0f0; }
        #game-over { background: rgba(0,0,0,0.9); flex-direction: column; z-index: 200;}
        button { padding: 10px 20px; background: #4caf50; color: white; border: none; cursor: pointer; margin-top: 15px; font-weight: bold;}

        @keyframes pulse { from { transform: scale(0.8); } to { transform: scale(1.1); } }
    </style>
</head>
<body>

    <div id="ui">
        <span>üíé: <span id="score">0</span></span>
        <span>‚ù§Ô∏è: <span id="lives">3</span></span>
    </div>
    
    <div id="game-container">
        <div id="player"></div>
        <div id="victory-overlay"><h1>BRAVO!</h1></div>
        <div id="game-over">
            <h2>SISTEM CRITIC!</h2>
            <p>Scor final: <span id="final-score">0</span></p>
            <button onclick="location.reload()">REPORNIRE</button>
        </div>
    </div>

    <div id="controls">
        <div class="btn" id="btn-up">‚ñ≤</div>
        <div class="btn" id="btn-left">‚óÄ</div>
        <div class="btn" id="btn-down">‚ñº</div>
        <div class="btn" id="btn-right">‚ñ∂</div>
    </div>

<script>
    const container = document.getElementById('game-container');
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const victoryOverlay = document.getElementById('victory-overlay');
    const gameOverScreen = document.getElementById('game-over');

    const ROWS = 13;
    const COLS = 9;
    const CELL_SIZE = 35; // Trebuie sƒÉ fie egal cu --cell-size din CSS
    let score = 0, lives = 3, grid = [], crystalsLeft = 0, gameActive = true;
    let playerPos = { x: 4, y: 0 };

    function initGame() {
        // »òtergem celulele vechi (fƒÉrƒÉ player)
        const cells = container.querySelectorAll('.cell');
        cells.forEach(c => c.remove());
        
        grid = [];
        crystalsLeft = 0;
        playerPos = { x: 4, y: 0 };
        victoryOverlay.style.display = 'none';
        
        for (let y = 0; y < ROWS; y++) {
            grid[y] = [];
            for (let x = 0; x < COLS; x++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                let type = 'dirt';
                if (y === 0 && x === 4) type = 'empty';
                else if (Math.random() < 0.15 && y > 1) type = 'rock';
                else if (Math.random() < 0.10 && y > 1) { type = 'crystal'; crystalsLeft++; }
                
                cell.classList.add(type);
                container.appendChild(cell);
                grid[y][x] = { el: cell, type: type };
            }
        }
        if (crystalsLeft === 0) { grid[5][5].type = 'crystal'; grid[5][5].el.className = 'cell crystal'; crystalsLeft = 1; }
        updatePlayerDisplay();
    }

    function updatePlayerDisplay() {
        const p = document.getElementById('player');
        p.style.left = (playerPos.x * CELL_SIZE) + 'px';
        p.style.top = (playerPos.y * CELL_SIZE) + 'px';
    }

    function movePlayer(dir) {
        if (!gameActive) return;
        let nx = playerPos.x;
        let ny = playerPos.y;

        if (dir === 'up') ny--;
        if (dir === 'down') ny++;
        if (dir === 'left') nx--;
        if (dir === 'right') nx++;

        if (nx >= 0 && nx < COLS && ny >= 0 && ny < ROWS) {
            if (grid[ny][nx].type !== 'rock') {
                playerPos.x = nx;
                playerPos.y = ny;
                const current = grid[ny][nx];
                if (current.type === 'dirt' || current.type === 'crystal') {
                    if (current.type === 'crystal') { score += 50; crystalsLeft--; scoreEl.innerText = score; }
                    current.type = 'empty';
                    current.el.className = 'cell empty';
                    checkVictory();
                }
                updatePlayerDisplay();
            }
        }
    }

    // Controale TastaturƒÉ
    window.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowUp') movePlayer('up');
        if (e.key === 'ArrowDown') movePlayer('down');
        if (e.key === 'ArrowLeft') movePlayer('left');
        if (e.key === 'ArrowRight') movePlayer('right');
    });

    // Controale Butoane Mobil
    document.getElementById('btn-up').addEventListener('touchstart', (e) => { e.preventDefault(); movePlayer('up'); });
    document.getElementById('btn-down').addEventListener('touchstart', (e) => { e.preventDefault(); movePlayer('down'); });
    document.getElementById('btn-left').addEventListener('touchstart', (e) => { e.preventDefault(); movePlayer('left'); });
    document.getElementById('btn-right').addEventListener('touchstart', (e) => { e.preventDefault(); movePlayer('right'); });

    // Suport Swipe (op»õional, pentru fluiditate)
    let touchStartX = 0;
    let touchStartY = 0;
    container.addEventListener('touchstart', e => {
        touchStartX = e.changedTouches[0].screenX;
        touchStartY = e.changedTouches[0].screenY;
    }, false);

    container.addEventListener('touchend', e => {
        let x = e.changedTouches[0].screenX;
        let y = e.changedTouches[0].screenY;
        let dx = x - touchStartX;
        let dy = y - touchStartY;
        if (Math.abs(dx) > Math.abs(dy)) {
            if (Math.abs(dx) > 30) movePlayer(dx > 0 ? 'right' : 'left');
        } else {
            if (Math.abs(dy) > 30) movePlayer(dy > 0 ? 'down' : 'up');
        }
    }, false);

    function checkVictory() {
        if (crystalsLeft === 0) {
            gameActive = false;
            score += 200;
            scoreEl.innerText = score;
            victoryOverlay.style.display = 'flex';
            setTimeout(() => { gameActive = true; initGame(); }, 2000);
        }
    }

    // Fizica Bolovanilor
    setInterval(() => {
        if (!gameActive) return;
        for (let y = ROWS - 1; y >= 0; y--) {
            for (let x = 0; x < COLS; x++) {
                if (grid[y][x].type === 'rock') {
                    let belowY = y + 1;
                    if (belowY < ROWS && grid[belowY][x].type === 'empty') {
                        if (playerPos.x === x && playerPos.y === belowY) hitPlayer();
                        grid[y][x].type = 'empty';
                        grid[y][x].el.className = 'cell empty';
                        grid[belowY][x].type = 'rock';
                        grid[belowY][x].el.className = 'cell rock';
                    }
                }
            }
        }
    }, 400);

    function hitPlayer() {
        lives--;
        livesEl.innerText = lives;
        container.style.boxShadow = "inset 0 0 50px red";
        setTimeout(() => container.style.boxShadow = "none", 300);
        if (lives <= 0) {
            gameActive = false;
            gameOverScreen.style.display = 'flex';
            document.getElementById('final-score').innerText = score;
        }
    }

    initGame();
</script>
</body>
</html>