<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sudoku Mic</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      background: #f4f6fb;
    }
    h1 {
      color: #333;
    }
    select, button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    #board {
      display: grid;
      margin: 20px 0;
      gap: 3px;
    }
    .cell {
      width: 40px;
      height: 40px;
      text-align: center;
      font-size: 18px;
      border: 1px solid #999;
      background: #fff;
    }
    #controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    #message {
      margin-top: 15px;
      font-weight: bold;
    }
    #timer {
      margin-top: 10px;
      font-size: 18px;
      font-weight: bold;
      color: #d9534f;
    }
  </style>
</head>
<body>
  <h1>Sudoku Mic</h1>
  <label for="size">Alege dimensiunea:</label>
  <select id="size">
    <option value="3">3x3</option>
    <option value="4">4x4</option>
    <option value="5">5x5</option>
  </select>
  <div id="board"></div>
  <div id="below-board">
    <button onclick="checkSolution()">Verifică</button>
  </div>
  <div id="controls">
    <button onclick="newGame()">Joc Nou</button>
    <button onclick="showSolution()">Arată Soluția</button>
    <button onclick="clearMistakes()">Șterge Greșeli</button>
  </div>
  <div id="timer">Timp: 00:00</div>
  <div id="message"></div>

  <script>
    let solution = [];
    let size = 3;
    let timerInterval;
    let timeLeft;

    function generateLatinSquare(n) {
      let grid = Array.from({ length: n }, () => Array(n).fill(0));
      function canPlace(row, col, num) {
        for (let i = 0; i < n; i++) {
          if (grid[row][i] === num || grid[i][col] === num) return false;
        }
        return true;
      }
      function solve(cell = 0) {
        if (cell === n * n) return true;
        let r = Math.floor(cell / n);
        let c = cell % n;
        let nums = [...Array(n).keys()].map(x => x + 1).sort(() => Math.random() - 0.5);
        for (let num of nums) {
          if (canPlace(r, c, num)) {
            grid[r][c] = num;
            if (solve(cell + 1)) return true;
            grid[r][c] = 0;
          }
        }
        return false;
      }
      solve();
      return grid;
    }

    function generatePuzzle(n) {
      let grid = generateLatinSquare(n);
      solution = grid.map(r => [...r]);
      let puzzle = grid.map(r => [...r]);
      let empties = Math.floor(n * n * 0.4);
      while (empties > 0) {
        let r = Math.floor(Math.random() * n);
        let c = Math.floor(Math.random() * n);
        if (puzzle[r][c] !== 0) {
          puzzle[r][c] = 0;
          empties--;
        }
      }
      return puzzle;
    }

    function renderBoard(puzzle) {
      const board = document.getElementById("board");
      board.innerHTML = "";
      board.style.gridTemplateColumns = `repeat(${size}, 40px)`;
      puzzle.forEach((row, r) => {
        row.forEach((val, c) => {
          let input = document.createElement("input");
          input.maxLength = 1;
          input.className = "cell";
          input.dataset.row = r;
          input.dataset.col = c;
          input.inputMode = "numeric";
          if (val !== 0) {
            input.value = val;
            input.disabled = true;
          }
          board.appendChild(input);
        });
      });
    }

    function newGame() {
      size = parseInt(document.getElementById("size").value);
      let puzzle = generatePuzzle(size);
      renderBoard(puzzle);
      document.getElementById("message").innerText = "";
      startTimer();
    }

    function checkSolution() {
      let inputs = document.querySelectorAll(".cell");
      for (let input of inputs) {
        let r = input.dataset.row;
        let c = input.dataset.col;
        if (parseInt(input.value) !== solution[r][c]) {
          document.getElementById("message").innerText = "Mai încearcă!";
          return;
        }
      }
      document.getElementById("message").innerText = "Bravo! Ai rezolvat!";
      clearInterval(timerInterval);
      setTimeout(newGame, 2000);
    }

    function showSolution() {
      let inputs = document.querySelectorAll(".cell");
      for (let input of inputs) {
        let r = input.dataset.row;
        let c = input.dataset.col;
        input.value = solution[r][c];
      }
      clearInterval(timerInterval);
    }

    function clearMistakes() {
      let inputs = document.querySelectorAll(".cell");
      for (let input of inputs) {
        let r = input.dataset.row;
        let c = input.dataset.col;
        if (!input.disabled && input.value && parseInt(input.value) !== solution[r][c]) {
          input.value = "";
        }
      }
    }

    function startTimer() {
      clearInterval(timerInterval);
      if (size === 3) timeLeft = 60;
      else if (size === 4) timeLeft = 120;
      else if (size === 5) timeLeft = 180;
      updateTimerDisplay();
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          document.getElementById("message").innerText = "Timp expirat!";
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      let min = Math.floor(timeLeft / 60);
      let sec = timeLeft % 60;
      document.getElementById("timer").innerText =
        `Timp: ${min.toString().padStart(2, "0")}:${sec.toString().padStart(2, "0")}`;
    }

    newGame();
  </script>
</body>
</html>
